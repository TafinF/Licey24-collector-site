<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="yandex" content="none">
    <meta name="slurp" content="noydir">
    <title>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        </div>

        {% if error %}
        <div class="error-message">
            {{ error }}
        </div>
        {% endif %}

        <form method="POST" class="login-form">
            <div class="form-group">
                <label for="password">üîë –ü–∞—Ä–æ–ª—å:</label>
                <div class="input-with-eye">
                    <input type="password" id="password" name="password" required 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                    <button type="button" class="eye-btn" onclick="togglePasswordVisibility('password')">
                        üëÅÔ∏è
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="encryption_key">üóùÔ∏è –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</label>
                <div class="input-with-eye">
                    <input type="password" id="encryption_key" name="encryption_key" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è">
                    <button type="button" class="eye-btn" onclick="togglePasswordVisibility('encryption_key')">
                        üëÅÔ∏è
                    </button>
                </div>
            </div>

            <div class="accordion">
                <button type="button" class="accordion-btn" onclick="toggleInstructions()">
                    üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
                    <span class="arrow">‚ñº</span>
                </button>
                <div class="accordion-content" id="instruction-content">
                    <div class="instruction-text">
                        <p>1. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                        <p>2. –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)</p>
                        <p>3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—Ö–æ–¥"</p>
                        <p>‚ö†Ô∏è <strong>–ù–µ –ø–µ—Ä–µ–ø—É—Ç–∞–π—Ç–µ –ø–æ–ª—è –≤–≤–æ–¥–∞!</strong></p>
                    </div>
                </div>
            </div>

            <button type="submit" class="login-btn">üöÄ –í—Ö–æ–¥</button>
        </form>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    window.addEventListener('load', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const passwordParam = urlParams.get('p');
        const keyParam = urlParams.get('k');
        
        if (passwordParam && keyParam) {
            // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª—è
            document.getElementById('password').value = passwordParam;
            document.getElementById('encryption_key').value = keyParam;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ LocalStorage
            if (keyParam) {
                localStorage.setItem('key_2025_2026_trim2', keyParam);
                console.log('üîë –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ LocalStorage –∏–∑ URL');
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            console.log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...');
            document.querySelector('.login-form').submit();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–∞ –∏–∑ LocalStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–æ–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π)
        const savedKey = localStorage.getItem('key_2025_2026_trim2');
        if (savedKey && !keyParam) {
            document.getElementById('encryption_key').value = savedKey;
        }
    });
    
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–∞ –≤ LocalStorage
        document.getElementById('encryption_key').addEventListener('input', function(e) {
            const key = e.target.value;
            if (key) {
                localStorage.setItem('key_2025_2026_trim2', key);
                console.log('üîë –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ LocalStorage');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–∞ –∏–∑ LocalStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            const savedKey = localStorage.getItem('key_2025_2026_trim2');
            if (savedKey) {
                document.getElementById('encryption_key').value = savedKey;
            }
        });

        // –û—á–∏—Å—Ç–∫–∞ LocalStorage –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–æ–ª—è –∫–ª—é—á–∞
        document.getElementById('encryption_key').addEventListener('change', function(e) {
            if (!e.target.value) {
                localStorage.removeItem('key_2025_2026_trim2');
            }
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
        function toggleInstructions() {
            const content = document.getElementById('instruction-content');
            const arrow = document.querySelector('.arrow');
            
            if (content.style.display === 'block') {
                content.style.display = 'none';
                arrow.textContent = '‚ñº';
            } else {
                content.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è/–∫–ª—é—á–∞
        function togglePasswordVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const eyeBtn = field.parentNode.querySelector('.eye-btn');
            
            if (field.type === 'password') {
                field.type = 'text';
                eyeBtn.textContent = 'üôà';
                eyeBtn.title = '–°–∫—Ä—ã—Ç—å';
            } else {
                field.type = 'password';
                eyeBtn.textContent = 'üëÅÔ∏è';
                eyeBtn.title = '–ü–æ–∫–∞–∑–∞—Ç—å';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        let visibilityTimeout;
        function togglePasswordVisibilityWithTimeout(fieldId) {
            const field = document.getElementById(fieldId);
            const eyeBtn = field.parentNode.querySelector('.eye-btn');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
            if (visibilityTimeout) {
                clearTimeout(visibilityTimeout);
            }
            
            if (field.type === 'password') {
                field.type = 'text';
                eyeBtn.textContent = 'üôà';
                eyeBtn.title = '–°–∫—Ä—ã—Ç—å (–∞–≤—Ç–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫)';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                visibilityTimeout = setTimeout(() => {
                    if (field.type === 'text') {
                        field.type = 'password';
                        eyeBtn.textContent = 'üëÅÔ∏è';
                        eyeBtn.title = '–ü–æ–∫–∞–∑–∞—Ç—å';
                    }
                }, 5000);
            } else {
                field.type = 'password';
                eyeBtn.textContent = 'üëÅÔ∏è';
                eyeBtn.title = '–ü–æ–∫–∞–∑–∞—Ç—å';
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        document.querySelectorAll('.eye-btn').forEach(btn => {
            const originalOnClick = btn.getAttribute('onclick');
            if (originalOnClick) {
                btn.setAttribute('onclick', originalOnClick.replace('togglePasswordVisibility', 'togglePasswordVisibilityWithTimeout'));
            }
        });
    </script>
</body>
</html>